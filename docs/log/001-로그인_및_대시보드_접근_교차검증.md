# 001. ë¡œê·¸ì¸ ë° ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ê¸°ëŠ¥ êµì°¨ ê²€ì¦ ë¡œê·¸

**ìµœì¢… ì—…ë°ì´íŠ¸:** 2025-10-31
**ìƒíƒœ:** âœ… ì „ì²´ êµ¬í˜„ ì™„ë£Œ

---

## ğŸ“Œ êµ¬í˜„ ì˜ë„

`docs/spec/001-plan-ë¡œê·¸ì¸-ë°-ëŒ€ì‹œë³´ë“œ-ì ‘ê·¼.md` ë° `docs/spec/001-spec-ë¡œê·¸ì¸-ë°-ëŒ€ì‹œë³´ë“œ-ì ‘ê·¼.md` ë¬¸ì„œì— ë”°ë¼, Djangoì˜ ë‚´ì¥ ì¸ì¦ ì‹œìŠ¤í…œì„ í™œìš©í•˜ì—¬ ì‚¬ìš©ì ë¡œê·¸ì¸ ë° ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ì œì–´ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ëª©í‘œì˜€ìŠµë‹ˆë‹¤.

**í•µì‹¬ ìš”êµ¬ì‚¬í•­:**
1. ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
2. ë¡œê·¸ì¸ ì„±ê³µ â†’ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
3. ì´ë¯¸ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í˜ì´ì§€ ì ‘ê·¼ â†’ ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
4. API ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ ì œì–´
5. ê´€ë¦¬ì í˜ì´ì§€ ê¶Œí•œ ê²€ì¦

---

## âœ… ì˜ëœ ì  (ì´ˆê¸° êµ¬í˜„)

1. âœ… **Django ë‚´ì¥ ì¸ì¦ ì‹œìŠ¤í…œ**: `LoginView`, `LogoutView` ì ìš©
2. âœ… **ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ì œì–´**: `@login_required` ë°ì½”ë ˆì´í„° ì ìš© (TC-01)
3. âœ… **ë¡œê·¸ì¸ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸**: `LOGIN_REDIRECT_URL`, `redirect_authenticated_user=True` (TC-02)
4. âœ… **ë¡œê·¸ì¸ í¼ ì—ëŸ¬ ì²˜ë¦¬**: Django ê¸°ë³¸ í¼ ì—ëŸ¬ ì²˜ë¦¬ (TC-04)
5. âœ… **ë£¨íŠ¸ URL ë¦¬ë‹¤ì´ë ‰íŠ¸**: `/` â†’ `/dashboard/`

---

## ğŸ†• ì¶”ê°€ êµ¬í˜„ ì‚¬í•­ (ê°œì„  ì™„ë£Œ)

### Issue #1: API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„ âœ…

**ì´ì „ ìƒíƒœ:**
- `ChartDataAPIView`ê°€ êµ¬í˜„ë˜ì§€ ì•ŠìŒ
- TC-03 ê²€ì¦ ë¶ˆê°€

**í•´ê²° ë°©ë²•:**

#### 1. `apps/dashboard/services.py` ì‘ì„±
```python
def get_dashboard_data(year=None, department=None):
    """ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í•„í„°ë§ëœ ë°ì´í„° ì¡°íšŒ"""

def to_chartjs(records):
    """ë°ì´í„°ë¥¼ Chart.js í˜¸í™˜ JSONìœ¼ë¡œ ë³€í™˜"""
```

**íŠ¹ì§•:**
- íƒ€ì… íŒíŒ… ì™„ì „ ì ìš© (Type hints)
- ë™ê¸° ì²˜ë¦¬ (ë¹„ë™ê¸° ì—†ìŒ)
- ìƒ‰ìƒ ìë™ í• ë‹¹
- ì—°ë„ë³„ ë°ì´í„° ê·¸ë£¹í™”

#### 2. `apps/dashboard/views.py` í™•ì¥
```python
@method_decorator(login_required, name="dispatch")
class ChartDataAPIView(APIView):
    def get(self, request):
        # year, department íŒŒë¼ë¯¸í„° ê²€ì¦
        # 400: invalid_parameter
        # 200: Chart.js JSON
        # 500: server_error
```

**íŠ¹ì§•:**
- `@login_required` ë°ì½”ë ˆì´í„° ì ìš©
- íŒŒë¼ë¯¸í„° ê²€ì¦ (yearëŠ” ì •ìˆ˜)
- ì˜ˆì™¸ ì²˜ë¦¬
- DRF APIView ì‚¬ìš©

#### 3. URL ë¼ìš°íŒ… ì¶”ê°€
```python
# apps/dashboard/urls.py
path("api/chart-data/", ChartDataAPIView.as_view(), name="chart-data-api")

# config/urls.py
path("api/dashboard/", include("apps.dashboard.urls"))
```

**ê²°ê³¼:**
- `/api/dashboard/chart-data/?year=2024&department=ì»´í“¨í„°ê³µí•™ê³¼` ì ‘ê·¼ ê°€ëŠ¥

---

### Issue #2: ê´€ë¦¬ì í˜ì´ì§€ ê¶Œí•œ ì œì–´ ëª…ì‹œí™” âœ…

**ì´ì „ ìƒíƒœ:**
- Django Admin ê¸°ë³¸ ë™ì‘ì—ë§Œ ì˜ì¡´
- ëª…ì‹œì  ê¶Œí•œ ë©”ì„œë“œ ì—†ìŒ

**í•´ê²° ë°©ë²•:**

#### `apps/ingest/admin.py` ê°œì„ 
```python
@admin.register(MetricRecord)
class MetricRecordAdmin(admin.ModelAdmin):

    def has_add_permission(self, request):
        """ì§ì ‘ ì¶”ê°€ ê¸ˆì§€ (íŒŒì¼ ì—…ë¡œë“œë§Œ í—ˆìš©)"""
        return False

    def has_change_permission(self, request, obj=None):
        """is_staff ê²€ì¦"""
        return request.user.is_staff

    def has_delete_permission(self, request, obj=None):
        """is_staff ê²€ì¦"""
        return request.user.is_staff

    def has_view_permission(self, request, obj=None):
        """is_staff ê²€ì¦"""
        return request.user.is_staff
```

**íŠ¹ì§•:**
- ëª…ì‹œì  ê¶Œí•œ ë©”ì„œë“œ êµ¬í˜„
- `is_staff` ì²´í¬ í†µí•©
- ì§ì ‘ ì¶”ê°€ëŠ” ë¶ˆê°€ëŠ¥ (MVP ì •ì±…)
- ì½ê¸°, ìˆ˜ì •, ì‚­ì œëŠ” staffë§Œ ê°€ëŠ¥

---

## ğŸ“Š í˜„ì¬ êµ¬í˜„ ìƒíƒœ

### í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì¶©ì¡± í˜„í™©

| TC | í•­ëª© | ìƒíƒœ | êµ¬í˜„ íŒŒì¼ |
|----|----|------|---------|
| **TC-01** | ë¹„ë¡œê·¸ì¸ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ | âœ… ì™„ë£Œ | `apps/dashboard/views.py:20-31` |
| **TC-02** | ë¡œê·¸ì¸ í›„ `/login/` â†’ ëŒ€ì‹œë³´ë“œ | âœ… ì™„ë£Œ | `config/urls.py:14-19` |
| **TC-03** | ë¹„ë¡œê·¸ì¸ â†’ API ê±°ë¶€ | âœ… ìƒˆë¡œ êµ¬í˜„ | `apps/dashboard/views.py:58-109` |
| **TC-03-1** | ë¡œê·¸ì¸ â†’ API ì„±ê³µ | âœ… ìƒˆë¡œ êµ¬í˜„ | `apps/dashboard/services.py` |
| **TC-04** | ì˜ëª»ëœ ID/PW | âœ… ì™„ë£Œ | `templates/registration/login.html` |
| **TC-05** | ê´€ë¦¬ì ê¶Œí•œ ê²€ì¦ | âœ… ëª…ì‹œí™” | `apps/ingest/admin.py:59-81` |

---

## ğŸ“ ë³€ê²½ëœ íŒŒì¼ ëª©ë¡

### ìƒˆë¡œ ì‘ì„±ëœ íŒŒì¼
1. âœ… `apps/dashboard/services.py` - ì„œë¹„ìŠ¤ í•¨ìˆ˜
2. âœ… `docs/log/001-test-ë¡œê·¸ì¸ë°ëŒ€ì‹œë³´ë“œ_í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤.md` - ì¢…í•© í…ŒìŠ¤íŠ¸ ë¬¸ì„œ

### ìˆ˜ì •ëœ íŒŒì¼
1. âœ… `apps/dashboard/views.py` - `ChartDataAPIView` ì¶”ê°€
2. âœ… `apps/dashboard/urls.py` - API URL ë§¤í•‘
3. âœ… `config/urls.py` - API ê²½ë¡œ í¬í•¨
4. âœ… `apps/ingest/admin.py` - ê¶Œí•œ ë©”ì„œë“œ ì¶”ê°€

---

## ğŸ”— API ìŠ¤í™ ìš”ì•½

### Endpoint: GET `/api/dashboard/chart-data/`

#### ìš”ì²­
```bash
GET /api/dashboard/chart-data/?year=2024&department=ì»´í“¨í„°ê³µí•™ê³¼
Authorization: Session (Cookie)
```

#### ì‘ë‹µ (200 OK)
```json
{
  "labels": ["2023", "2024"],
  "datasets": [
    {
      "label": "PAPER",
      "data": [10, 15],
      "backgroundColor": "#4A90E2"
    }
  ]
}
```

#### ì—ëŸ¬ ì‘ë‹µ
- **400 Bad Request:** `{"error": "invalid_parameter"}` - yearê°€ ì •ìˆ˜ ì•„ë‹˜
- **401 Unauthorized:** `@login_required` ìë™ ì²˜ë¦¬
- **500 Internal Server Error:** `{"error": "server_error"}`

---

## ğŸ¯ ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê¸°ëŠ¥
- âœ… `DashboardView` - í…œí”Œë¦¿ ë Œë”ë§ + ê¸°ë³¸ê°’ context
- âœ… `ChartDataAPIView` - API ì—”ë“œí¬ì¸íŠ¸
- âœ… `get_dashboard_data()` - DB ì¡°íšŒ
- âœ… `to_chartjs()` - ë°ì´í„° ë³€í™˜
- âœ… `MetricRecordAdmin` - ê¶Œí•œ ì œì–´

### ë¼ìš°íŒ…
- âœ… `/dashboard/` â†’ `DashboardView`
- âœ… `/api/dashboard/chart-data/` â†’ `ChartDataAPIView`
- âœ… `/login/` â†’ `LoginView`
- âœ… `/logout/` â†’ `LogoutView`

### ë¬¸ì„œí™”
- âœ… ë„ë©”ì¸ ë¡œì§ ì£¼ì„ (docstrings)
- âœ… API ëª…ì„¸ ì£¼ì„
- âœ… íƒ€ì… íŒíŒ… ì™„ì „ ì ìš©
- âœ… ì¢…í•© í…ŒìŠ¤íŠ¸ ë¬¸ì„œ

---

## ğŸ” ì½”ë“œ í’ˆì§ˆ

### Type Hints
```python
def get_dashboard_data(
    year: Optional[int] = None,
    department: Optional[str] = None
) -> List[Dict[str, Any]]:
```
âœ… ì™„ì „ ì ìš©

### Docstrings
```python
"""Module documentation

Detailed description with examples
"""
```
âœ… ëª¨ë“  í•¨ìˆ˜/í´ë˜ìŠ¤ì— ì ìš©

### í•˜ë“œì½”ë”© ê°’
- âŒ ì—†ìŒ
- ìƒ‰ìƒì€ `_get_color_for_metric()` í•¨ìˆ˜ë¡œ ê´€ë¦¬
- ì„¤ì •ê°’ì€ `settings.py` ì°¸ì¡°

### Import ê´€ë¦¬
- âœ… í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¨¼ì €
- âœ… ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬
- âœ… ë¡œì»¬ import

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

### 1. Type & Lint ê²€ì‚¬
```bash
# Type checking (mypy)
mypy apps/dashboard apps/ingest

# Lint (flake8, pylint)
flake8 apps/dashboard apps/ingest
pylint apps/dashboard apps/ingest
```

### 2. ë¹Œë“œ ê²€ì¦
```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ê²€ì‚¬
python manage.py makemigrations --dry-run

# ì„¤ì • ê²€ì¦
python manage.py check

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
python manage.py test
```

### 3. í…ŒìŠ¤íŠ¸ ìë™í™”
- `tests/test_001_login_dashboard.py` ì‘ì„±
- Django TestCase í™œìš©

---

## ğŸ“ ê²°ë¡ 

**ìƒíƒœ:** âœ… **ì™„ì „íˆ ì™„ë£Œ**

ì´ˆê¸° êµì°¨ê²€ì¦ì—ì„œ ì§€ì ëœ ë‘ ê°€ì§€ ë¯¸êµ¬í˜„ ì‚¬í•­:

1. âœ… **API ì—”ë“œí¬ì¸íŠ¸ (TC-03)** â†’ ì™„ì „íˆ êµ¬í˜„ë¨
   - `ChartDataAPIView` í´ë˜ìŠ¤
   - íŒŒë¼ë¯¸í„° ê²€ì¦
   - ë¡œê·¸ì¸ ì œì–´
   - Chart.js í˜¸í™˜ ì‘ë‹µ

2. âœ… **ê´€ë¦¬ì ê¶Œí•œ ì œì–´ (TC-05)** â†’ ëª…ì‹œí™”ë¨
   - `has_*_permission()` ë©”ì„œë“œ
   - `is_staff` ê²€ì¦
   - ì§ì ‘ ì¶”ê°€ ê¸ˆì§€

ëª¨ë“  í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤(TC-01~05)ê°€ êµ¬í˜„ ì™„ë£Œë˜ì—ˆìœ¼ë©°, ì½”ë“œëŠ” ë‹¤ìŒ ê¸°ì¤€ì„ ì¶©ì¡±í•©ë‹ˆë‹¤:
- íƒ€ì… ì•ˆì •ì„± (Type hints)
- ì½”ë“œ ë¬¸ì„œí™” (Docstrings)
- í•˜ë“œì½”ë”© ì—†ìŒ (ì„¤ì • ê¸°ë°˜)
- DRF í‘œì¤€ ì¤€ìˆ˜
- Django ëª¨ë²” ì‚¬ë¡€

ë‹¤ìŒ ë‹¨ê³„: ìë™í™” í…ŒìŠ¤íŠ¸ ì‘ì„± ë° ì„±ëŠ¥ ê²€ì¦
