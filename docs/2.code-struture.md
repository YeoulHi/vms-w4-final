project_root/
├── config/                     # Django settings, urls, wsgi/asgi
├── apps/
│   ├── dashboard/              # "보여주는 쪽" 전담
│   │   ├── __init__.py
│   │   ├── urls.py
│   │   ├── views.py            # /dashboard/, /api/dashboard/chart-data/
│   │   ├── services.py         # 대시보드용 도메인 로직 (연도/학과 데이터 조회)
│   │   ├── utils/
│   │   │   └── chart_adapter.py  # 내부데이터 -> Chart.js 포맷 변환 (중요)
│   │   └── templates/
│   │       └── dashboard/
│   │           └── index.html
│   │
│   └── ingest/                 # "데이터 들여오는 쪽" 전담
│       ├── __init__.py
│       ├── admin.py            # Admin에서 엑셀 업로드 트리거
│       ├── models.py           # MetricRecord (year, department, …), UNIQUE(year, department)
│       ├── services.py         # pandas 파싱 + _upsert_metric_record()
│       └── exceptions.py       # (선택) ParsingError 등
│
├── requirements.txt
└── manage.py

# Code Structure — v1.1 (Final)

목적:
- 이카운트에서 내려받은 엑셀을 관리자(Admin)가 업로드하면,
  서버가 이를 파싱해 Supabase(PostgreSQL)에 저장하고,
  내부 사용자가 /dashboard/ 에서 Chart.js로 지표를 확인할 수 있게 한다.

구성:
1. apps/ingest
   - admin.py: Admin 업로드 엔트리
   - models.py: MetricRecord (UNIQUE(year, department))
   - services.py:
       - parse_and_save_excel(file): pandas로 파싱 후 행 단위 처리
       - _upsert_metric_record(row): ORM 호출을 한 곳에 모아둔 private 함수
   - exceptions.py (optional): 파싱 실패시 사용할 커스텀 예외

2. apps/dashboard
   - views.py:
       - GET /dashboard/ : 템플릿 렌더
       - GET /api/dashboard/chart-data/ : DRF로 JSON 응답
   - services.py:
       - get_dashboard_data(year=None, department=None): 도메인 데이터 조회
   - utils/chart_adapter.py:
       - to_chartjs(data): 내부 도메인 데이터를 Chart.js가 바로 그릴 수 있는 구조로 변환
   - templates/dashboard/index.html:
       - Chart.js 로딩 및 /api/dashboard/chart-data/ 호출

원칙:
- Presentation(view, template) 은 비즈니스(service)와 분리한다.
- 비즈니스(service)는 DB ORM 코드를 직접 여기저기 쓰지 않고, services 내 private 함수로 캡슐화한다.
- 외부 포맷(Chart.js)은 utils로 분리해 내부 도메인이 외부 라이브러리에 종속되지 않도록 한다.
- 불필요한 디렉터리(repositories, interfaces)는 생성하지 않는다.

